<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF 테두리 표시</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <style>
        #pdf-container {
            position: relative;
            display: block;
            border: 1px solid black;
        }
        canvas {
            display: block;
        }
        .highlight-box {
            position: absolute;
            border: 2px solid red;
            background-color: rgba(255, 255, 255, 0.2);
            transition: background-color 0.3s;
        }
        .highlight-box:hover {
            background-color: rgba(255, 0, 0, 0.5);
        }
    </style>
</head>
<body>
<h1>PDF 테두리 표시</h1>
<div id="pdf-container"></div>

<script>
    const pdfUrl = "/25_O_odd.pdf";
    const jsonUrl = "/res_json.json";

    const pdfContainer = document.getElementById("pdf-container");

    pdfjsLib.getDocument(pdfUrl).promise.then(pdf => {
        fetch(jsonUrl)
            .then(response => response.json())
            .then(data => {
                const processedRects = new Map(); // 페이지별 테두리 저장

                // JSON 데이터를 페이지별로 정리
                data.forEach(rect => {
                    if (!processedRects.has(rect.page)) {
                        processedRects.set(rect.page, new Set());
                    }
                    const rectKey = `${rect.x}-${rect.y}-${rect.width}-${rect.height}`;
                    processedRects.get(rect.page).add(rectKey);
                });

                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    if (!processedRects.has(pageNum)) continue;

                    pdf.getPage(pageNum).then(page => {
                        const viewport = page.getViewport({ scale: 1.5 });
                        const pageWrapper = document.createElement("div");
                        pageWrapper.style.position = "relative";
                        pageWrapper.style.width = `${viewport.width}px`;
                        pageWrapper.style.height = `${viewport.height}px`;
                        pdfContainer.appendChild(pageWrapper);

                        const canvas = document.createElement("canvas");
                        canvas.width = viewport.width;
                        canvas.height = viewport.height;
                        pageWrapper.appendChild(canvas);
                        const ctx = canvas.getContext("2d");

                        const renderContext = {
                            canvasContext: ctx,
                            viewport: viewport
                        };
                        page.render(renderContext);

                        processedRects.get(pageNum).forEach(rectKey => {
                            const [x, y, width, height] = rectKey.split("-").map(Number);

                            const div = document.createElement("div");
                            div.className = "highlight-box";
                            div.style.left = `${x * 1.5}px`;
                            div.style.top = `${y * 1.5}px`;
                            div.style.width = `${width * 1.5}px`;
                            div.style.height = `${height * 1.5}px`;
                            div.style.position = "absolute";
                            div.style.zIndex = "10";
                            div.style.pointerEvents = "auto";
                            pageWrapper.appendChild(div);
                        });
                    });
                }
            });
    });
</script>
</body>
</html>
